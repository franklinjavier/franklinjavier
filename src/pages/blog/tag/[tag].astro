---
import { getCollection } from 'astro:content'
import BlogByTag from '../../../components/BlogByTag.astro'
import { parseTags } from '../../../i18n/utils'

export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ data }) => {
    return data.draft !== true && data.lang === 'en'
  })

  const tags = new Set<string>()
  posts.forEach(post => {
    parseTags(post.data.tags).forEach(tag => tags.add(tag))
  })

  return Array.from(tags).map(tag => ({
    params: { tag: tag.toLowerCase().replace(/\s+/g, '-') },
    props: { tag }
  }))
}

const { tag } = Astro.props
---

<BlogByTag lang="en" tag={tag} />
